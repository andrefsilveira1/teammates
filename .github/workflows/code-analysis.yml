name: Code Quality Analysis

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  static-analysis:
    name: Run Static Code Analysis
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Echo - Starting static analysis process
        run: |
          echo "The job was automatically triggered by a ${{ github.event_name }} event."
          echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
          echo "Starting static code analysis process üîç"

      - name: Install Java
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-11-jdk

      - name: Install SpotBugs
        run: |
          wget https://github.com/spotbugs/spotbugs/releases/download/spotbugs-4.6.0/spotbugs-4.6.0.tar.gz
          tar -xvzf spotbugs-4.6.0.tar.gz
          sudo mv spotbugs-4.6.0 /opt/spotbugs
          echo "SpotBugs installed successfully."

      - name: Run SpotBugs analysis (without Maven)
        run: |
          echo "Running SpotBugs analysis"
          /opt/spotbugs/bin/spotbugs -textui -effort:max -low -recursive .

      - name: Echo - SpotBugs analysis complete
        run: echo "üéâ SpotBugs analysis complete üéâ"

  code-metrics:
    name: Run Code Metrics Analysis
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Echo - Starting code metrics analysis process
        run: |
          echo "The job was automatically triggered by a ${{ github.event_name }} event."
          echo "This job is now running on a ${{ runner.os }} server hosted by GitHub!"
          echo "Starting code metrics analysis process üìä"

      - name: Install Java and PMD
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-11-jdk
          wget https://github.com/pmd/pmd/releases/download/pmd_releases/6.46.0/pmd-bin-6.46.0.zip
          unzip pmd-bin-6.46.0.zip
          sudo mv pmd-bin-6.46.0 /opt/pmd
          echo "PMD installed successfully."

      - name: Run PMD metrics analysis (without Maven)
        run: |
          echo "Running PMD metrics analysis"
          /opt/pmd/bin/run.sh pmd -d . -R rulesets/java/quickstart.xml -f text

      - name: Echo - PMD metrics analysis complete
        run: echo "PMD metrics analysis complete."
