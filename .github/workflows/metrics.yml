name: Code Metrics Analysis

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  ck-metrics:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Echo - Checking out the code
        run: echo "üîÑ Checking out the code..."

      - name: Setup JDK
        uses: actions/setup-java@v2
        with:
          java-version: '17' 
          distribution: 'temurin'

      - name: Echo - JDK setup complete
        run: echo "‚òï JDK 17 is ready."

      - name: Install CK
        run: |
          echo "Cloning CK repository..."
          git clone https://github.com/mauricioaniche/ck.git
          cd ck
          echo "Building CK jar..."
          mvn clean compile assembly:single
          echo "CK jar built successfully."

      - name: Run CK Metrics Analysis
        run: |
          echo "‚öôÔ∏è Running CK metrics analysis on the code..."
          mkdir -p ck-output
          # Run the CK analysis and redirect output to different CSV files
          java -jar ck/target/ck-*-SNAPSHOT-jar-with-dependencies.jar src/main/java false 0
          # Assuming that CK generates class.csv, field.csv, method.csv, and variable.csv in ck-output
          mv ck/*.csv ck-output/
          echo "‚úÖ CK metrics analysis finished!"

      - name: Upload CK Metrics CSVs
        uses: actions/upload-artifact@v3
        with:
          name: ck-metrics
          path: ck-output/*.csv 
